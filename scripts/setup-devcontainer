#!/usr/bin/env bash
set -ex
cd "$(dirname "$0")/.."

# Clone only if the folder doesn't exist
if [[ ! -d "core" ]]; then
    git clone --depth 1 --branch dev https://github.com/home-assistant/core.git
fi

# Install uv package manager explcitly (required for venv creation and script execution in devcontainer / local usage)
pip install \
    colorlog \
    pip \
    ruff \
    uv

# Clean up pip cache to reduce container size
pip cache purge

# Create clean virtual environment
uv venv --clear --python 3.13
./scripts/setup-dependencies
./scripts/setup-symlinks
uv run pre-commit install-hooks
